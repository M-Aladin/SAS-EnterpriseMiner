*------------------------------------------------------------*
* Training Log
Date:                May 09, 2018
Time:                15:05:51
*------------------------------------------------------------*
11405  proc freq data=EMWS4.Clus_VariableSet noprint;
11406  table ROLE*LEVEL/out=WORK.ClusMETA;
11407  run;

NOTE: There were 26 observations read from the data set EMWS4.CLUS_VARIABLESET.
NOTE: The data set WORK.CLUSMETA has 6 observations and 4 variables.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
      

11408  proc print data=WORK.ClusMETA label noobs;
11409  var ROLE LEVEL COUNT;
11410  label ROLE = "%sysfunc(sasmsg(sashelp.dmine, meta_role_vlabel, NOQUOTE))" LEVEL = "%sysfunc(sasmsg(sashelp.dmine, meta_level_vlabel, NOQUOTE))" COUNT = "%sysfunc(sasmsg(sashelp.dmine, rpt_count_vlabel, NOQUOTE))";
11411  title9 ' ';
11412  title10 "%sysfunc(sasmsg(sashelp.dmine, rpt_varSummary_title  , NOQUOTE))";
11413  run;

NOTE: There were 6 observations read from the data set WORK.CLUSMETA.
NOTE: The PROCEDURE PRINT printed page 1.
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      

11414  title10;

11415  data WORK.M3TDJ45F;
11416  set WORK.M3TDJ45F;
11417  if role eq 'REJECTED' then role = 'INPUT';
11418  run;

NOTE: There were 18 observations read from the data set WORK.M3TDJ45F.
NOTE: The data set WORK.M3TDJ45F has 18 observations and 21 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

11427  *------------------------------------------------------------*;
11428  * Clus: Preliminary Clustering;
11429  *------------------------------------------------------------*;
11430  *------------------------------------------------------------* ;
11431  * Clus: DMDBClass Macro ;
11432  *------------------------------------------------------------* ;
11433  %macro DMDBClass;
11434      CampaignViewedEmail(ASC) FacebookLike(ASC) LoyaltyClass(ASC)
11435     MobileApplications(ASC) PreviousCampaign(ASC) REP_AdvertisementZone(ASC)
11436     REP_ClusterGroup(ASC) REP_Gender(ASC) REP_Region(ASC)
11437  %mend DMDBClass;
11438  *------------------------------------------------------------* ;
11439  * Clus: DMDBVar Macro ;
11440  *------------------------------------------------------------* ;
11441  %macro DMDBVar;
11442      AffluenceGrade CleanserProducts DayCareProducts LotionProducts
11443     NightRepairProducts REP_Age REP_LoyaltyTime TimeSinceLastPurchase TotalSpend
11444  %mend DMDBVar;
11445  *------------------------------------------------------------*;
11446  * Clus: Create DMDB;
11447  *------------------------------------------------------------*;
11448  proc dmdb batch data=EMWS4.Filter_TRAIN
11449  dmdbcat=WORK.Clus_DMDB
11450  maxlevel = 513
11451  out=WORK.Clus_DMDB
11452  ;
11453  class %DMDBClass;
11454  var %DMDBVar;
11455  run;

NOTE: Records processed = 20035   Memory used = 511K.
NOTE: There were 23000 observations read from the data set SUPERMKT.SUPERMARKETCAMPAIGN.
NOTE: There were 23000 observations read from the data set EMWS4.IDS_DATA.
NOTE: View EMWS4.FILTER_TRAIN.VIEW used (Total process time):
      real time           0.26 seconds
      cpu time            0.25 seconds
      
NOTE: There were 23000 observations read from the data set EMWS4.REPL_TRAIN.
NOTE: There were 20035 observations read from the data set EMWS4.FILTER_TRAIN.
NOTE: The data set WORK.CLUS_DMDB has 20035 observations and 18 variables.
NOTE: PROCEDURE DMDB used (Total process time):
      real time           0.29 seconds
      cpu time            0.28 seconds
      

11456  quit;
11457  *--- end code ---*;

11458  *------------------------------------------------------------* ;
11459  * Clus: Interval Inputs Macro ;
11460  *------------------------------------------------------------* ;
11461  %macro DMVQINTERVAL;
11462      AffluenceGrade CleanserProducts DayCareProducts LotionProducts
11463     NightRepairProducts REP_Age REP_LoyaltyTime TimeSinceLastPurchase TotalSpend
11464  %mend DMVQINTERVAL;
11465  *------------------------------------------------------------* ;
11466  * Clus: Nominal Inputs Macro ;
11467  *------------------------------------------------------------* ;
11468  %macro DMVQNOMINAL;
11469      CampaignViewedEmail FacebookLike LoyaltyClass MobileApplications
11470     PreviousCampaign REP_AdvertisementZone REP_ClusterGroup REP_Gender REP_Region
11471  %mend DMVQNOMINAL;
11472  *------------------------------------------------------------*;
11473  * Clus: Run DMVQ procedure;
11474  *------------------------------------------------------------*;
11475  title;
11476  options nodate;
11477  proc dmvq data=WORK.Clus_DMDB dmdbcat=WORK.Clus_DMDB std=STD nominal=GLM ordinal=RANK
11478  ;
NOTE: The training set WORK.CLUS_DMDB.DATA has 18 variable(s).
NOTE: The DMVQ statement has finished with return code=0 and status=begin.
11479  input %DMVQINTERVAL / level=interval;
NOTE: 9 input variable(s) defined for ID=I1.
NOTE: The INPUT statement has finished with return code=0 and status=variables.
11480  input %DMVQNOMINAL / level=nominal;
NOTE: 9 input variable(s) defined for ID=I2.
NOTE: The INPUT statement has finished with return code=0 and status=variables.
11481  VQ maxc = 50 clusname=_SEGMENT_ CLUSLABEL="Segment Id" DISTLABEL="Distance";
NOTE: A maximum of 50 clusters have been requested.
NOTE: The VQ statement has finished with return code=0 and status=architecture.
11482  MAKE outvar=EMWS4.Clus_OUTVAR;

NOTE: 18 input variable(s).
NOTE: Number of cases=20035
NOTE: Sum of frequencies=20035
NOTE: Sum of weights=20035
NOTE: VARDEF=DF      
NOTE: Maximum number of categories=14
NOTE: The total number of variables is 18 with dimensionality 51.
NOTE: 18 variables will be used for clustering.
NOTE: Open output data set EMWS4.CLUS_OUTVAR.DATA with 52 variables.
NOTE: The data set EMWS4.CLUS_OUTVAR has 4 observations and 52 variables.
NOTE: The MAKE statement has finished with return code=0 and status=made.
11483  INITIAL radius=0
11484  ;
NOTE: 50 seeds were selected from data set WORK.CLUS_DMDB.DATA using the SEPARATE algorithm.
NOTE: The INITIAL statement has finished with return code=0 and status=initialized.
11485  TRAIN tech=FORGY
11486  ;
WARNING: The limit of 10 iterations was reached without convergence.
NOTE: The TRAIN statement has finished with return code=0 and status=trained.
11487  SAVE outstat=WORK.Clus_OUTSTAT outmean=EMWS4.Clus_OUTMEAN;
NOTE: The data set WORK.CLUS_OUTSTAT has 316 observations and 54 variables.
NOTE: The data set EMWS4.CLUS_OUTMEAN has 50 observations and 60 variables.
NOTE: The SAVE statement has finished with return code=0 and status=statistics.
11488  code file="D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS4\Clus\DMVQSCORECODE.sas"
11489  group=Clus
11490  ;
NOTE: External file D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS4\Clus\DMVQSCORECODE.sas opened.
NOTE: The CODE statement has finished with return code=0 and status=statistics.
11491  run;

11492  quit;

NOTE: There were 20035 observations read from the data set WORK.CLUS_DMDB.
NOTE: PROCEDURE DMVQ used (Total process time):
      real time           1.09 seconds
      cpu time            1.07 seconds
      

11493  proc transpose data=EMWS4.Clus_OUTVAR out=WORK.Clus_OUTVAR(where=(COL1 ^in('IMPUTED','OMITTED')));
11494  var AffluenceGrade--REP_RegionU;
11495  where _TYPE_ in('TYPE' 'VARIABLE');
11496  run;

NOTE: There were 2 observations read from the data set EMWS4.CLUS_OUTVAR.
      WHERE _TYPE_ in ('TYPE', 'VARIABLE');
NOTE: The data set WORK.CLUS_OUTVAR has 51 observations and 4 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
      

11497  *------------------------------------------------------------* ;
11498  * Clus: DMVQ Variables;
11499  *------------------------------------------------------------* ;
11500  %macro dmvqvars;
11501      AffluenceGrade CleanserProducts DayCareProducts LotionProducts
11502     NightRepairProducts REP_Age REP_LoyaltyTime TimeSinceLastPurchase TotalSpend
11503     CampaignViewedEmail0 CampaignViewedEmail1 FacebookLike0 FacebookLike1
11504     LoyaltyClassDiamond LoyaltyClassGold LoyaltyClassPlatinum LoyaltyClassSilver
11505     MobileApplications0 MobileApplications1 PreviousCampaign0 PreviousCampaign1
11506     REP_AdvertisementZBorder REP_AdvertisementZCentral_Z1
11507     REP_AdvertisementZE_Central REP_AdvertisementZN_Central
11508     REP_AdvertisementZN_East REP_AdvertisementZN_West REP_AdvertisementZNE_Z1
11509     REP_AdvertisementZNE_Z2 REP_AdvertisementZNE_Z3 REP_AdvertisementZS_Central
11510     REP_AdvertisementZS_East REP_AdvertisementZS_West REP_AdvertisementZU
11511     REP_AdvertisementZW_Central REP_ClusterGroupA REP_ClusterGroupB
11512     REP_ClusterGroupC REP_ClusterGroupD REP_ClusterGroupE REP_ClusterGroupF
11513     REP_ClusterGroupU REP_GenderF REP_GenderM REP_GenderU REP_RegionCentral
11514     REP_RegionNorth REP_RegionNorthEast REP_RegionSouth_East REP_RegionSouth_West
11515     REP_RegionU
11516  %mend ;
11517  
11518  

11519  *------------------------------------------------------------*;
11520  * Clus: Determining the number of clusters;
11521  *------------------------------------------------------------*;
11522  proc cluster data=EMWS4.Clus_OUTMEAN method=WARD pseudo outtree=EMWS4.Clus_CLUSSEED
11523  ;
11524  var %dmvqvars;
11525  copy _SEGMENT_;
11526  run;

NOTE: The data set EMWS4.CLUS_CLUSSEED has 99 observations and 68 variables.
NOTE: The PROCEDURE CLUSTER printed page 2.
NOTE: PROCEDURE CLUSTER used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      

11527  quit;
11528  proc sort data =EMWS4.Clus_CLUSSEED out=WORK._SEED_;
11529  by _ncl_;
11530  where (_ccc_ > -99999.0);
11531  run;

NOTE: There were 49 observations read from the data set EMWS4.CLUS_CLUSSEED.
      WHERE _ccc_>-99999;
NOTE: The data set WORK._SEED_ has 49 observations and 68 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

11532  data WORK._SEED2_;
11533  retain oJump occc oncl;
11534  set WORK._SEED_;
11535  _lccc_=lag(_ccc_);
11536  if _lccc_ > . then jump = _ccc_ - _lccc_;
11537  if jump<0 and ojump>0 then do;
11538  * Have a local Max;
11539  numclus = oncl;
11540  cccvalue = occc;
11541  output;
11542  end;
11543  ojump = jump;
11544  occc = _ccc_;
11545  oncl = _ncl_;
11546  run;

NOTE: There were 49 observations read from the data set WORK._SEED_.
NOTE: The data set WORK._SEED2_ has 2 observations and 75 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

11547  proc print data=WORK._SEED2_ label;
11548  var numclus cccvalue;
11549  label numclus="%sysfunc(sasmsg(sashelp.dmine, rpt_numclus_vlabel ,  NOQUOTE))";
11550  label cccvalue="%sysfunc(sasmsg(sashelp.dmine, rpt_ccc_vlabel ,     NOQUOTE))";
11551  title10 "%sysfunc(sasmsg(sashelp.dmine, rpt_OptClus_title, NOQUOTE))";
11552  run;

NOTE: There were 2 observations read from the data set WORK._SEED2_.
NOTE: The PROCEDURE PRINT printed page 3.
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

11553  title10;

11554  data WORK._SEED2_;
11555  length msg $200;
11556  set WORK._SEED2_ end=eof;
11557  retain select cccSelect 0 numSel;
11558  if _N_=1 then numSel = numClus;
11559  if cccvalue>=3 then do;
11560  if 20>= numclus >= 2 and cccSelect<1 then do;
11561  cccSelect = 1;
11562  select =1;
11563  numSel = numClus;
11564  end;
11565  end;
11566  else if 20>= numclus >= 2 and select<1 then do;
11567  select = 1;
11568  numSel = numClus;
11569  end;
11570  if eof then do;
11571  if ^(select=1 and cccselect=1) then do;
11572  put "*------------------------------------------------------------*";
11573  put '*;';
11574  put "WARNING: The number of clusters selected based on the CCC values may not be valid.  Please refer to the documentation on the Cubic Clustering Criterion.";
11575  put '*;';
11576  put "*------------------------------------------------------------*";
11577  end;
11578  if select<1 then do;
11579  msg = sasmsg('sashelp.dmine', 'rpt_noCCCclusternum_note', 'NOQUOTE');
11580  put msg;
11581  end;
11582  if cccselect<1 then do;
11583  msg = sasmsg('sashelp.dmine', 'rpt_noValidclusterNum_note', 'NOQUOTE');
11584  put msg;
11585  end;
11586  call symput('em_maxC', strip(put(numSel,best.)));
11587  end;
11588  run;

NOTE: There were 2 observations read from the data set WORK._SEED2_.
NOTE: The data set WORK._SEED2_ has 2 observations and 79 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

11589  *------------------------------------------------------------*;
11590  * Clus: Training;
11591  *------------------------------------------------------------*;
11592  *------------------------------------------------------------*;
11593  * Clus: Run DMVQ procedure;
11594  *------------------------------------------------------------*;
11595  title;
11596  options nodate;
11597  proc dmvq data=WORK.Clus_DMDB dmdbcat=WORK.Clus_DMDB std=STD nominal=GLM ordinal=RANK
11598  ;
NOTE: The training set WORK.CLUS_DMDB.DATA has 18 variable(s).
NOTE: The DMVQ statement has finished with return code=0 and status=begin.
11599  input %DMVQINTERVAL / level=interval;
NOTE: 9 input variable(s) defined for ID=I1.
NOTE: The INPUT statement has finished with return code=0 and status=variables.
11600  input %DMVQNOMINAL / level=nominal;
NOTE: 9 input variable(s) defined for ID=I2.
NOTE: The INPUT statement has finished with return code=0 and status=variables.
11601  VQ maxc = 2 clusname=_SEGMENT_ CLUSLABEL="Segment Id" DISTLABEL="Distance";
NOTE: A maximum of 2 clusters have been requested.
NOTE: The VQ statement has finished with return code=0 and status=architecture.
11602  MAKE outvar=EMWS4.Clus_OUTVAR;

NOTE: 18 input variable(s).
NOTE: Number of cases=20035
NOTE: Sum of frequencies=20035
NOTE: Sum of weights=20035
NOTE: VARDEF=DF      
NOTE: Maximum number of categories=14
NOTE: The total number of variables is 18 with dimensionality 51.
NOTE: 18 variables will be used for clustering.
NOTE: Open output data set EMWS4.CLUS_OUTVAR.DATA with 52 variables.
NOTE: The data set EMWS4.CLUS_OUTVAR has 4 observations and 52 variables.
NOTE: The MAKE statement has finished with return code=0 and status=made.
11603  INITIAL radius=0
11604  ;
NOTE: 2 seeds were selected from data set WORK.CLUS_DMDB.DATA using the SEPARATE algorithm.
NOTE: The INITIAL statement has finished with return code=0 and status=initialized.
11605  TRAIN tech=FORGY
11606  ;
WARNING: The limit of 10 iterations was reached without convergence.
NOTE: The TRAIN statement has finished with return code=0 and status=trained.
11607  SAVE outstat=EMWS4.Clus_OUTSTAT outmean=EMWS4.Clus_OUTMEAN;
NOTE: The data set EMWS4.CLUS_OUTSTAT has 28 observations and 54 variables.
NOTE: The data set EMWS4.CLUS_OUTMEAN has 2 observations and 60 variables.
NOTE: The SAVE statement has finished with return code=0 and status=statistics.
11608  code file="D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS4\Clus\DMVQSCORECODE.sas"
11609  group=Clus
11610  ;
NOTE: External file D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS4\Clus\DMVQSCORECODE.sas opened.
NOTE: The CODE statement has finished with return code=0 and status=statistics.
11611  run;

11612  quit;

NOTE: There were 20035 observations read from the data set WORK.CLUS_DMDB.
NOTE: PROCEDURE DMVQ used (Total process time):
      real time           0.42 seconds
      cpu time            0.42 seconds
      

11613  libname _spdslib;
WARNING: Libref _SPDSLIB is not assigned.

11614  *------------------------------------------------------------*;
11615  * Clus: Cluster Label;
11616  *------------------------------------------------------------*;
11617  data EMWS4.Clus_LABEL;
11618  length _SEGMENT_ 8 Label $80;
11619  format _SEGMENT_ 4.;
11620  label _SEGMENT_ = "%sysfunc(sasmsg(sashelp.dmine, rpt_segmentName_vlabel,  NOQUOTE))";
11621  label Label = "%sysfunc(sasmsg(sashelp.dmine, rpt_segmentLabel_vlabel,  NOQUOTE))";
11622  _SEGMENT_= 1;
11623  Label='Cluster1';
11624  output;
11625  _SEGMENT_= 2;
11626  Label='Cluster2';
11627  output;
11628  run;

NOTE: The data set EMWS4.CLUS_LABEL has 2 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      


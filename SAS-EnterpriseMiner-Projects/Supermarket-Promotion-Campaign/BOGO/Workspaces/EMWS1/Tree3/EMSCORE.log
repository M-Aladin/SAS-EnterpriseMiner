*------------------------------------------------------------*
* Score Log
Date:                May 09, 2018
Time:                14:20:03
*------------------------------------------------------------*
17171  %let EMEXCEPTIONSTRING=;
17172  *------------------------------------------------------------*;
17173  * SCORE: Tree3;
17174  *------------------------------------------------------------*;
17175  %let EM_ACTION = SCORE;
17176  %let syscc = 0;
17177  %macro main;
17178  
17179    %if %upcase(&EM_ACTION) = CREATE %then %do;
17180      filename temp catalog 'sashelp.emmodl.tree_create.source';
17181      %include temp;
17182      filename temp;
17183  
17184      %em_tree_create;
17185    %end;
17186  
17187     %else
17188     %if %upcase(&EM_ACTION) = TRAIN %then %do;
17189  
17190         filename temp catalog 'sashelp.emmodl.tree_train.source';
17191         %include temp;
17192         filename temp;
17193         %em_tree_train;
17194     %end;
17195  
17196    %else
17197    %if %upcase(&EM_ACTION) = SCORE %then %do;
17198      filename temp catalog 'sashelp.emmodl.tree_score.source';
17199      %include temp;
17200      filename temp;
17201  
17202      %em_tree_score;
17203  
17204    %end;
17205  
17206    %else
17207    %if %upcase(&EM_ACTION) = REPORT %then %do;
17208  
17209         filename temp catalog 'sashelp.emmodl.tree_report.source';
17210         %include temp;
17211         filename temp;
17212  
17213         %em_tree_report;
17214     %end;
17215  
17216    %else
17217    %if %upcase(&EM_ACTION) = OPENINT %then %do;
17218  
17219         filename temp catalog 'sashelp.emmodl.tree_actions.source';
17220         %include temp;
17221         filename temp;
17222         %EM_TREE_OPENTREEVIEWER;
17223  
17224     %end;
17225  
17226    %else
17227    %if %upcase(&EM_ACTION) = CLOSEINT %then %do;
17228  
17229         filename temp catalog 'sashelp.emmodl.tree_actions.source';
17230         %include temp;
17231         filename temp;
17232         %EM_TREE_CLOSETREEVIEWER;
17233  
17234     %end;
17235  
17236  
17237     %doendm:
17238  %mend main;
17239  
17240  %main;
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMMODL.TREE_SCORE.SOURCE.
17242 +%macro em_tree_score;
17244 +   /* determine if multiple targets will be processed */
17245 +   %let em_tree_multipleTargets=N;
17246 +   %let em_tree_numTarget=1;
17247 +   %if "&EM_PROPERTY_USEMULTIPLETARGET" eq "Y" %then %do;
17248 +      /* determine if there are any ordinal target variables - if so, multiple targets are not supported */
17249 +      %if &EM_NUM_ORDINAL_TARGET gt 0 %then %do;
17250 +         %let em_tree_multipleTargets=N;
17251 +      %end;
17252 +      %else %do;
17253 +         /* create macro array of targets  */
17254 +         data _null_;
17255 +           set &EM_DATA_VARIABLESET(where=(ROLE='TARGET' AND LEVEL^='ORDINAL')) end=eof;
17256 +           call symput('em_tree_targetVars'!!strip(put(_N_, BEST.)), strip(Name));
17257 +           if eof then
17258 +             call symput('em_tree_numTarget', strip(put(_N_, BEST.)));
17259 +        run;
17261 +        %if &em_tree_numTarget gt 1 %then %do;
17262 +           %let em_tree_multipleTargets=Y;
17263 +        %end;
17264 +      %end;
17265 +   %end;
17267 +   /* build flow and publish scoring code */
17268 +   %EM_GETNAME(key=TREEFLOW, type=FILE, extension=sas);
17269 +   %EM_GETNAME(key=TREEPUBLISH, type=FILE, extension=sas);
17271 +   filename treeflow "&EM_USER_TREEFLOW";
17272 +   filename treepub "&EM_USER_TREEPUBLISH";
17274 +   filename flowref  "&EM_FILE_EMFLOWSCORECODE";
17275 +   filename pubref   "&EM_FILE_EMPUBLISHSCORECODE";
17277 +   %em_copyfile(infref=treeflow, outfref=flowref);
17278 +   %em_copyfile(infref=treepub, outfref=pubref);
17280 +   filename treeflow;
17281 +   filename treepub;
17283 +   /* if priors are used, add code to generate unadjusted residuals in export */
17284 +   %let useAdjPriors = N;
17285 +   data _null_;
17286 +     set &EM_DEC_DECMETA(where=(_TYPE_="DECPRIOR"));
17287 +     if USE="Y" then call symput('useAdjPriors', 'Y');
17288 +   run;
17289 +   %if (("&em_tree_multipleTargets" eq "N") AND ("&useAdjPriors" eq "Y")) %then %do;
17290 +      filename temp catalog 'sashelp.emutil.em_makeunadjustedresidualvars.source';
17291 +      %include temp;
17292 +      filename temp;
17294 +      %EM_GETNAME(key=adjResidualCode, type=FILE, extension=sas);
17295 +      filename adjref "&EM_USER_adjResidualCode";
17296 +      %makeUnadjustedResidualVars(target=%EM_TARGET, decmeta=&EM_DEC_DECMETA, fref=adjref);
17298 +      %em_copyfile(infref=adjref, outfref=flowref, append=Y);
17300 +      filename adjref;
17301 +   %end;
17303 +   /* LEAF */
17304 +   %if "&EM_PROPERTY_LEAFID" eq "Y" %then %do;
17305 +      data _null_;
17306 +        file flowref mod;
17307 +        put 'drop _LEAF_;';
17308 +      run;
17310 +      data _null_;
17311 +        file pubref mod;
17312 +        put 'drop _LEAF_;';
17313 +      run;
17315 +   %end;
17317 +   filename flowref;
17318 +   filename pubref;
17320 +   /* em_metachange code */
17321 +   %if "&EM_PROPERTY_LEAFID" eq "Y" %then %do;
17322 +     %EM_METACHANGE(name=_NODE_, role=&EM_PROPERTY_NODEROLE, LEVEL=NOMINAL);
17323 +   %end;
17325 +   /* variable selection based on importance stat    */
17326 +   %if "&EM_PROPERTY_VARSELECTION" eq "Y" %then %do;
17327 +     %EM_GETNAME(key=OUTIMPORT, type=DATA);
17328 +     %let dsid = %sysfunc(open(&EM_USER_OUTIMPORT(where=(IMPORTANCE<0.05))));
17329 +     %let varnum = %sysfunc(varnum(&dsid, NAME));
17330 +     %let obs = %sysfunc(fetch(&dsid));
17331 +     %do %while(&obs=0);
17332 +       %let temp = %nrbquote(%sysfunc(getvarc(&dsid, &varnum)));
17333 +       %let varname = %nrbquote(%sysfunc(tranwrd(&temp,  %str(%"),"")));
17334 +       %EM_METACHANGE(name=&varname, role=REJECTED);
17335 +       %let obs = %sysfunc(fetch(&dsid));
17336 +     %end;
17337 +     %if &dsid %then %let dsid=%sysfunc(close(&dsid));
17338 +   %end;
17340 +   /* set Q_ varaibles to role of ASSESS when in the presense of prior probabilities */
17341 +   %if %sysfunc(exist(&EM_DEC_DECMETA)) %then %do;
17342 +    %let tree_pred_vars = ;
17343 +    %let tree_pred_lvl =;
17344 +    %let numpred= 0;
17346 +    data _null_;
17347 +     set &EM_DEC_DECMETA(where=(_TYPE_="PREDICTED")) end=eof;
17348 +     call symput('tree_pred_vars'!!strip(put(_N_, BEST.)), strip(VARIABLE));
17349 +     call symput('tree_pred_lvl'!!strip(put(_N_, BEST.)), strip(LEVEL));
17350 +     if eof then
17351 +       call symput('numpred', strip(put(_N_, BEST.)));
17352 +    run;
17353 +   %end;
17355 +   %if &numpred ne 0 %then %do;
17356 +    %do i=1 %to &numpred;
17357 +      %let qpred = Q%substr(&&tree_pred_vars&i,2);
17358 +      %EM_METACHANGE(name=&qpred, role=ASSESS);
17359 +    %end;
17360 +   %end;
17362 +   /* determine if multiple targets will be processed */
17363 +   %let em_tree_multipleTargets=N;
17364 +   %let em_tree_numTarget=1;
17365 +   %if "&EM_PROPERTY_USEMULTIPLETARGET" eq "Y" %then %do;
17366 +      /* determine if there are any ordinal target variables - if so, multiple targets are not supported */
17367 +      %if &EM_NUM_ORDINAL_TARGET gt 0 %then %do;
17368 +         %let em_tree_multipleTargets=N;
17369 +      %end;
17370 +      %else %do;
17371 +        data _null_;
17372 +          set &EM_DATA_VARIABLESET(where=(ROLE='TARGET' AND LEVEL^='ORDINAL')) end=eof;
17373 +          if eof then
17374 +            call symput('em_tree_numTarget', strip(put(_N_, BEST.)));
17375 +        run;
17377 +        %if &em_tree_numTarget gt 1 %then %do;
17378 +           %let em_tree_multipleTargets=Y;
17379 +        %end;
17380 +     %end;
17381 +   %end;
17383 +   /* need to include this code to do the %em_report for OUTIMPORT here instead of in Report code so _loop data set is created when group processing */
17384 +   %if "&em_tree_multipleTargets" eq "N" %then %do;
17386 +      /* variable importance */
17387 +      %EM_GETNAME(key=OUTIMPORT, type=DATA);
17388 +      %if %sysfunc(exist(&EM_USER_OUTIMPORT)) eq 1 %then %do;
17390 +         %let validexist=0;
17391 +         %if (("&EM_IMPORT_VALIDATE" ne "") AND (%sysfunc(exist(&EM_IMPORT_VALIDATE)) or %sysfunc(exist(&EM_IMPORT_VALIDATE,VIEW)))) %then %do;
17392 +           %let validexist=1;
17393 +         %end;
17395 +         /* determine if vars exists - properties could indicate they are they but freeze=Y would mean the node wasn't retrained */
17396 +         /* and the columns may not be generated                                                                                 */
17397 +         %let em_tree_cvexists=;
17398 +         %let em_tree_surrexists=.;
17399 +         data _null_;
17400 +            set &EM_USER_OUTIMPORT (obs=2) end=eof;
17401 +            if eof then do ;
17402 +               call symput("em_tree_cvexists" , strip(put(cvimportance,best.))) ;
17403 +               call symput("em_tree_surrexists", strip(put(nsurrogates, best.)));
17404 +            end;
17405 +         run;
17407 +         data &EM_USER_OUTIMPORT;
17408 +            set &EM_USER_OUTIMPORT;
17410 +            /* format columns based on Precison value specified */
17411 +            format importance 15.&EM_PROPERTY_PRECISION
17412 +                 %if &validexist %then %do;
17413 +                   vimportance ratio 15.&EM_PROPERTY_PRECISION
17414 +                 %end;
17415 +                 %if "&EM_TREE_CVEXISTS" ne "." %then %do;
17416 +                   cvimportance vimportance ratio 15.&EM_PROPERTY_PRECISION
17417 +                 %end;
17418 +            ;
17419 +            label  NAME       = "%sysfunc(sasmsg(sashelp.dmine, meta_name_vlabel, noquote))"
17420 +                 LABEL        = "%sysfunc(sasmsg(sashelp.dmine, meta_label_vlabel, noquote))"
17421 +                 NRULES       = "%sysfunc(sasmsg(sashelp.dmine, rpt_nrules_vlabel, noquote))"
17422 +                 IMPORTANCE   = "%sysfunc(sasmsg(sashelp.dmine, rpt_importance_vlabel, noquote))"
17423 +                 %if "&em_tree_surrexists" ne "" %then %do;
17424 +                   NSURROGATES  = "%sysfunc(sasmsg(sashelp.dmine, rpt_nsurrogates_vlabel, noquote))"
17425 +                 %end;
17426 +                 %if &validexist %then %do;
17427 +                   VIMPORTANCE = "%sysfunc(sasmsg(sashelp.dmine, rpt_vimportance_vlabel, noquote))"
17428 +                   RATIO       = "%sysfunc(sasmsg(sashelp.dmine, rpt_ratio_vlabel, noquote))"
17429 +                 %end;
17430 +                 %if "&EM_TREE_CVEXISTS" ne "" %then %do;
17431 +                   VIMPORTANCE = "%sysfunc(sasmsg(sashelp.dmine, rpt_vimportance_vlabel, noquote))"
17432 +                   CVIMPORTANCE =  "%sysfunc(sasmsg(sashelp.dmine, rpt_cvimport_vlabel, noquote))"
17433 +                   CVRULES= "%sysfunc(sasmsg(sashelp.dmine, rpt_cvrules_vlabel, noquote))"
17434 +                   RATIO = "%sysfunc(sasmsg(sashelp.dmine, rpt_ratio_vlabel, noquote))"
17435 +                 %end;
17436 +            ;
17437 +         run;
17439 +         %EM_REPORT(key=OUTIMPORT, viewtype=DATA, block=MODEL, description=IMPORTANCE, autodisplay=N);
17440 +      %end;
17441 +   %end;
17443 +   %doendm:
17444 +%mend em_tree_score;
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref TEMP has been deassigned.

NOTE: The file FLOWREF is:
      Filename=D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\EMFLOWSCORE.sas,
      RECFM=V,LRECL=20000,File Size (bytes)=0,
      Last Modified=09May2018:14:20:03,
      Create Time=09May2018:14:20:03

NOTE: 358 records were written to the file FLOWREF.
      The minimum record length was 1.
      The maximum record length was 65.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      


NOTE: The file PUBREF is:
      Filename=D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\EMPUBLISHSCORE.sas,
      RECFM=V,LRECL=20000,File Size (bytes)=0,
      Last Modified=09May2018:14:20:03,
      Create Time=09May2018:14:20:03

NOTE: 336 records were written to the file PUBREF.
      The minimum record length was 1.
      The maximum record length was 65.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

NOTE: Fileref TREEFLOW has been deassigned.
NOTE: Fileref TREEPUB has been deassigned.

NOTE: There were 1 observations read from the data set EMWS1.IDS2_TARGETBUY_DM.
      WHERE _TYPE_='DECPRIOR';
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: The file FLOWREF is:
      Filename=D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\EMFLOWSCORE.sas,
      RECFM=V,LRECL=32767,File Size (bytes)=14046,
      Last Modified=09May2018:14:20:03,
      Create Time=09May2018:14:20:03

NOTE: 1 record was written to the file FLOWREF.
      The minimum record length was 12.
      The maximum record length was 12.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: The file PUBREF is:
      Filename=D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\EMPUBLISHSCORE.sas,
      RECFM=V,LRECL=32767,File Size (bytes)=13373,
      Last Modified=09May2018:14:20:03,
      Create Time=09May2018:14:20:03

NOTE: 1 record was written to the file PUBREF.
      The minimum record length was 12.
      The maximum record length was 12.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

NOTE: Fileref FLOWREF has been deassigned.
NOTE: Fileref PUBREF has been deassigned.

NOTE: The data set WORK.EM_METACHANGE has 1 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 1 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 2 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      


NOTE: There were 2 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 3 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 3 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 4 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 4 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 5 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      


NOTE: There were 5 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 6 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 6 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 7 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      


NOTE: There were 7 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 8 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 8 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 9 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 9 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 10 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      


NOTE: There were 10 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 11 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: There were 2 observations read from the data set EMWS1.IDS2_TARGETBUY_DM.
      WHERE _TYPE_='PREDICTED';
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: There were 11 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 12 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      


NOTE: There were 12 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 13 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      


NOTE: Variable cvimportance is uninitialized.
NOTE: Variable nsurrogates is uninitialized.
NOTE: There were 2 observations read from the data set EMWS1.TREE3_OUTIMPORT.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


NOTE: Variable NSURROGATES is uninitialized.
NOTE: Variable CVIMPORTANCE is uninitialized.
NOTE: Variable CVRULES is uninitialized.
NOTE: There were 18 observations read from the data set EMWS1.TREE3_OUTIMPORT.
NOTE: The data set EMWS1.TREE3_OUTIMPORT has 18 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.07 seconds
      cpu time            0.07 seconds
      


NOTE: The data set WORK.EM_USER_REPORT has 132 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.10 seconds
      

17445  
17446  *------------------------------------------------------------*;
17447  * End SCORE: Tree3;
17448  *------------------------------------------------------------*;

17449  proc sort data=WORK.EM_METACHANGE;
17450  by key uname;
17451  run;

NOTE: There were 13 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 13 observations and 9 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

17452  filename x "D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\CDELTA_TRAIN.sas";
17453  data _null_;
17454  file x;
17455  put 'if upcase(NAME) = "CAMPAIGNVIEWEDEMAIL" then do;';
17456  put 'ROLE = "REJECTED";';
17457  put 'end;';
17458  put 'else ';
17459  put 'if upcase(NAME) = "CLEANSERPRODUCTS" then do;';
17460  put 'ROLE = "REJECTED";';
17461  put 'end;';
17462  put 'else ';
17463  put 'if upcase(NAME) = "LOYALTYCLASS" then do;';
17464  put 'ROLE = "REJECTED";';
17465  put 'end;';
17466  put 'else ';
17467  put 'if upcase(NAME) = "PREVIOUSCAMPAIGN" then do;';
17468  put 'ROLE = "REJECTED";';
17469  put 'end;';
17470  put 'else ';
17471  put 'if upcase(NAME) = "Q_TARGETBUY0" then do;';
17472  put 'ROLE = "ASSESS";';
17473  put 'end;';
17474  put 'else ';
17475  put 'if upcase(NAME) = "Q_TARGETBUY1" then do;';
17476  put 'ROLE = "ASSESS";';
17477  put 'end;';
17478  put 'else ';
17479  put 'if upcase(NAME) = "REP_ADVERTISEMENTZONE" then do;';
17480  put 'ROLE = "REJECTED";';
17481  put 'end;';
17482  put 'else ';
17483  put 'if upcase(NAME) = "REP_CLUSTERGROUP" then do;';
17484  put 'ROLE = "REJECTED";';
17485  put 'end;';
17486  put 'else ';
17487  put 'if upcase(NAME) = "REP_LOYALTYTIME" then do;';
17488  put 'ROLE = "REJECTED";';
17489  put 'end;';
17490  put 'else ';
17491  put 'if upcase(NAME) = "REP_REGION" then do;';
17492  put 'ROLE = "REJECTED";';
17493  put 'end;';
17494  put 'else ';
17495  put 'if upcase(NAME) = "TIMESINCELASTPURCHASE" then do;';
17496  put 'ROLE = "REJECTED";';
17497  put 'end;';
17498  put 'else ';
17499  put 'if upcase(NAME) = "TOTALSPEND" then do;';
17500  put 'ROLE = "REJECTED";';
17501  put 'end;';
17502  put 'else ';
17503  put 'if upcase(NAME) = "_NODE_" then do;';
17504  put 'ROLE = "SEGMENT";';
17505  put 'LEVEL = "NOMINAL";';
17506  put 'end;';
17507  run;

NOTE: The file X is:
      Filename=D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\CDELTA_TRAIN.sas,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=09May2018:14:20:03,
      Create Time=01May2018:17:03:05

NOTE: 52 records were written to the file X.
      The minimum record length was 4.
      The maximum record length was 50.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

17508  filename x;
NOTE: Fileref X has been deassigned.

17509  filename emflow "D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\EMFLOWSCORE.sas";
17510  *------------------------------------------------------------*;
17511  * Tree3: Scoring DATA data;
17512  *------------------------------------------------------------*;
17513  data EMWS1.Tree3_TRAIN
17514  / view=EMWS1.Tree3_TRAIN
17515  ;
17516  set EMWS1.Part2_TRAIN
17517  ;
17518  %inc emflow;
NOTE: %INCLUDE (level 1) file EMFLOW is file D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\EMFLOWSCORE.sas.
17519 +****************************************************************;
17520 +******             DECISION TREE SCORING CODE             ******;
17521 +****************************************************************;
17522 +
17523 +******         LENGTHS OF NEW CHARACTER VARIABLES         ******;
17524 +LENGTH F_TargetBuy  $   12;
17525 +LENGTH I_TargetBuy  $   12;
17526 +LENGTH _WARN_  $    4;
17527 +
17528 +******              LABELS FOR NEW VARIABLES              ******;
17529 +label _NODE_ = 'Node' ;
17530 +label _LEAF_ = 'Leaf' ;
17531 +label P_TargetBuy0 = 'Predicted: TargetBuy=0' ;
17532 +label P_TargetBuy1 = 'Predicted: TargetBuy=1' ;
17533 +label Q_TargetBuy0 = 'Unadjusted P: TargetBuy=0' ;
17534 +label Q_TargetBuy1 = 'Unadjusted P: TargetBuy=1' ;
17535 +label V_TargetBuy0 = 'Validated: TargetBuy=0' ;
17536 +label V_TargetBuy1 = 'Validated: TargetBuy=1' ;
17537 +label R_TargetBuy0 = 'Residual: TargetBuy=0' ;
17538 +label R_TargetBuy1 = 'Residual: TargetBuy=1' ;
17539 +label F_TargetBuy = 'From: TargetBuy' ;
17540 +label I_TargetBuy = 'Into: TargetBuy' ;
17541 +label U_TargetBuy = 'Unnormalized Into: TargetBuy' ;
17542 +label _WARN_ = 'Warnings' ;
17543 +
17544 +
17545 +******      TEMPORARY VARIABLES FOR FORMATTED VALUES      ******;
17546 +LENGTH _ARBFMT_12 $     12; DROP _ARBFMT_12;
17547 +_ARBFMT_12 = ' '; /* Initialize to avoid warning. */
17548 +LENGTH _ARBFMT_1 $      1; DROP _ARBFMT_1;
17549 +_ARBFMT_1 = ' '; /* Initialize to avoid warning. */
17550 +
17551 +
17552 +_ARBFMT_12 = PUT( TargetBuy , BEST12.);
17553 + %DMNORMCP( _ARBFMT_12, F_TargetBuy );
17554 +
17555 +******             ASSIGN OBSERVATION TO NODE             ******;
17556 +IF  NOT MISSING(REP_Age ) AND
17557 +  REP_Age  <                 44.5 THEN DO;
17558 +  _ARBFMT_1 = PUT( REP_Gender , $CHAR1.);
17559 +   %DMNORMIP( _ARBFMT_1);
17560 +  IF _ARBFMT_1 IN ('M' ,'U' ) THEN DO;
17561 +    IF  NOT MISSING(AffluenceGrade ) AND
17562 +                      10.5 <= AffluenceGrade  THEN DO;
17563 +      IF  NOT MISSING(AffluenceGrade ) AND
17564 +                        15.5 <= AffluenceGrade  THEN DO;
17565 +        _NODE_  =                   19;
17566 +        _LEAF_  =                    6;
17567 +        P_TargetBuy0  =     0.12195121951219;
17568 +        P_TargetBuy1  =      0.8780487804878;
17569 +        Q_TargetBuy0  =     0.12195121951219;
17570 +        Q_TargetBuy1  =      0.8780487804878;
17571 +        V_TargetBuy0  =     0.20930232558139;
17572 +        V_TargetBuy1  =      0.7906976744186;
17573 +        I_TargetBuy  = '1' ;
17574 +        U_TargetBuy  =                    1;
17575 +        END;
17576 +      ELSE DO;
17577 +        IF  NOT MISSING(NightRepairProducts ) AND
17578 +          NightRepairProducts  <                  0.5 THEN DO;
17579 +          _NODE_  =                   36;
17580 +          _LEAF_  =                    4;
17581 +          P_TargetBuy0  =     0.64516129032258;
17582 +          P_TargetBuy1  =     0.35483870967741;
17583 +          Q_TargetBuy0  =     0.64516129032258;
17584 +          Q_TargetBuy1  =     0.35483870967741;
17585 +          V_TargetBuy0  =             0.546875;
17586 +          V_TargetBuy1  =             0.453125;
17587 +          I_TargetBuy  = '0' ;
17588 +          U_TargetBuy  =                    0;
17589 +          END;
17590 +        ELSE DO;
17591 +          _NODE_  =                   37;
17592 +          _LEAF_  =                    5;
17593 +          P_TargetBuy0  =     0.41666666666666;
17594 +          P_TargetBuy1  =     0.58333333333333;
17595 +          Q_TargetBuy0  =     0.41666666666666;
17596 +          Q_TargetBuy1  =     0.58333333333333;
17597 +          V_TargetBuy0  =     0.51351351351351;
17598 +          V_TargetBuy1  =     0.48648648648648;
17599 +          I_TargetBuy  = '1' ;
17600 +          U_TargetBuy  =                    1;
17601 +          END;
17602 +        END;
17603 +      END;
17604 +    ELSE DO;
17605 +      IF  NOT MISSING(REP_Age ) AND
17606 +        REP_Age  <                 29.5 THEN DO;
17607 +        _ARBFMT_12 = PUT( MobileApplications , BEST12.);
17608 +         %DMNORMIP( _ARBFMT_12);
17609 +        IF _ARBFMT_12 IN ('1' ) THEN DO;
17610 +          _NODE_  =                   33;
17611 +          _LEAF_  =                    2;
17612 +          P_TargetBuy0  =     0.09090909090909;
17613 +          P_TargetBuy1  =      0.9090909090909;
17614 +          Q_TargetBuy0  =     0.09090909090909;
17615 +          Q_TargetBuy1  =      0.9090909090909;
17616 +          V_TargetBuy0  =     0.03703703703703;
17617 +          V_TargetBuy1  =     0.96296296296296;
17618 +          I_TargetBuy  = '1' ;
17619 +          U_TargetBuy  =                    1;
17620 +          END;
17621 +        ELSE DO;
17622 +          _NODE_  =                   32;
17623 +          _LEAF_  =                    1;
17624 +          P_TargetBuy0  =     0.73170731707317;
17625 +          P_TargetBuy1  =     0.26829268292682;
17626 +          Q_TargetBuy0  =     0.73170731707317;
17627 +          Q_TargetBuy1  =     0.26829268292682;
17628 +          V_TargetBuy0  =     0.65116279069767;
17629 +          V_TargetBuy1  =     0.34883720930232;
17630 +          I_TargetBuy  = '0' ;
17631 +          U_TargetBuy  =                    0;
17632 +          END;
17633 +        END;
17634 +      ELSE DO;
17635 +        _NODE_  =                   17;
17636 +        _LEAF_  =                    3;
17637 +        P_TargetBuy0  =     0.80877742946708;
17638 +        P_TargetBuy1  =     0.19122257053291;
17639 +        Q_TargetBuy0  =     0.80877742946708;
17640 +        Q_TargetBuy1  =     0.19122257053291;
17641 +        V_TargetBuy0  =     0.79756468797564;
17642 +        V_TargetBuy1  =     0.20243531202435;
17643 +        I_TargetBuy  = '0' ;
17644 +        U_TargetBuy  =                    0;
17645 +        END;
17646 +      END;
17647 +    END;
17648 +  ELSE DO;
17649 +    IF  NOT MISSING(AffluenceGrade ) AND
17650 +      AffluenceGrade  <                  8.5 THEN DO;
17651 +      IF  NOT MISSING(REP_Age ) AND
17652 +        REP_Age  <                 31.5 THEN DO;
17653 +        _NODE_  =                   20;
17654 +        _LEAF_  =                    7;
17655 +        P_TargetBuy0  =     0.17582417582417;
17656 +        P_TargetBuy1  =     0.82417582417582;
17657 +        Q_TargetBuy0  =     0.17582417582417;
17658 +        Q_TargetBuy1  =     0.82417582417582;
17659 +        V_TargetBuy0  =     0.31683168316831;
17660 +        V_TargetBuy1  =     0.68316831683168;
17661 +        I_TargetBuy  = '1' ;
17662 +        U_TargetBuy  =                    1;
17663 +        END;
17664 +      ELSE DO;
17665 +        IF  NOT MISSING(NightRepairProducts ) AND
17666 +          NightRepairProducts  <                  0.5 THEN DO;
17667 +          _NODE_  =                   42;
17668 +          _LEAF_  =                    8;
17669 +          P_TargetBuy0  =     0.73142857142857;
17670 +          P_TargetBuy1  =     0.26857142857142;
17671 +          Q_TargetBuy0  =     0.73142857142857;
17672 +          Q_TargetBuy1  =     0.26857142857142;
17673 +          V_TargetBuy0  =     0.65340909090909;
17674 +          V_TargetBuy1  =      0.3465909090909;
17675 +          I_TargetBuy  = '0' ;
17676 +          U_TargetBuy  =                    0;
17677 +          END;
17678 +        ELSE DO;
17679 +          _ARBFMT_12 = PUT( FacebookLike , BEST12.);
17680 +           %DMNORMIP( _ARBFMT_12);
17681 +          IF _ARBFMT_12 IN ('1' ) THEN DO;
17682 +            _NODE_  =                   65;
17683 +            _LEAF_  =                   10;
17684 +            P_TargetBuy0  =     0.37426900584795;
17685 +            P_TargetBuy1  =     0.62573099415204;
17686 +            Q_TargetBuy0  =     0.37426900584795;
17687 +            Q_TargetBuy1  =     0.62573099415204;
17688 +            V_TargetBuy0  =     0.38541666666666;
17689 +            V_TargetBuy1  =     0.61458333333333;
17690 +            I_TargetBuy  = '1' ;
17691 +            U_TargetBuy  =                    1;
17692 +            END;
17693 +          ELSE DO;
17694 +            _NODE_  =                   64;
17695 +            _LEAF_  =                    9;
17696 +            P_TargetBuy0  =     0.56950672645739;
17697 +            P_TargetBuy1  =      0.4304932735426;
17698 +            Q_TargetBuy0  =     0.56950672645739;
17699 +            Q_TargetBuy1  =      0.4304932735426;
17700 +            V_TargetBuy0  =     0.63084112149532;
17701 +            V_TargetBuy1  =     0.36915887850467;
17702 +            I_TargetBuy  = '0' ;
17703 +            U_TargetBuy  =                    0;
17704 +            END;
17705 +          END;
17706 +        END;
17707 +      END;
17708 +    ELSE DO;
17709 +      _ARBFMT_12 = PUT( MobileApplications , BEST12.);
17710 +       %DMNORMIP( _ARBFMT_12);
17711 +      IF _ARBFMT_12 IN ('0' ) THEN DO;
17712 +        IF  NOT MISSING(AffluenceGrade ) AND
17713 +                          11.5 <= AffluenceGrade  THEN DO;
17714 +          _NODE_  =                   45;
17715 +          _LEAF_  =                   13;
17716 +          P_TargetBuy0  =     0.23170731707317;
17717 +          P_TargetBuy1  =     0.76829268292682;
17718 +          Q_TargetBuy0  =     0.23170731707317;
17719 +          Q_TargetBuy1  =     0.76829268292682;
17720 +          V_TargetBuy0  =     0.19642857142857;
17721 +          V_TargetBuy1  =     0.80357142857142;
17722 +          I_TargetBuy  = '1' ;
17723 +          U_TargetBuy  =                    1;
17724 +          END;
17725 +        ELSE DO;
17726 +          IF  NOT MISSING(LotionProducts ) AND
17727 +                             4.5 <= LotionProducts  THEN DO;
17728 +            _NODE_  =                   67;
17729 +            _LEAF_  =                   12;
17730 +            P_TargetBuy0  =     0.61904761904761;
17731 +            P_TargetBuy1  =     0.38095238095238;
17732 +            Q_TargetBuy0  =     0.61904761904761;
17733 +            Q_TargetBuy1  =     0.38095238095238;
17734 +            V_TargetBuy0  =     0.53658536585365;
17735 +            V_TargetBuy1  =     0.46341463414634;
17736 +            I_TargetBuy  = '0' ;
17737 +            U_TargetBuy  =                    0;
17738 +            END;
17739 +          ELSE DO;
17740 +            _NODE_  =                   66;
17741 +            _LEAF_  =                   11;
17742 +            P_TargetBuy0  =     0.34269662921348;
17743 +            P_TargetBuy1  =     0.65730337078651;
17744 +            Q_TargetBuy0  =     0.34269662921348;
17745 +            Q_TargetBuy1  =     0.65730337078651;
17746 +            V_TargetBuy0  =     0.41545893719806;
17747 +            V_TargetBuy1  =     0.58454106280193;
17748 +            I_TargetBuy  = '1' ;
17749 +            U_TargetBuy  =                    1;
17750 +            END;
17751 +          END;
17752 +        END;
17753 +      ELSE DO;
17754 +        _NODE_  =                   23;
17755 +        _LEAF_  =                   14;
17756 +        P_TargetBuy0  =                 0.15;
17757 +        P_TargetBuy1  =                 0.85;
17758 +        Q_TargetBuy0  =                 0.15;
17759 +        Q_TargetBuy1  =                 0.85;
17760 +        V_TargetBuy0  =     0.18568994889267;
17761 +        V_TargetBuy1  =     0.81431005110732;
17762 +        I_TargetBuy  = '1' ;
17763 +        U_TargetBuy  =                    1;
17764 +        END;
17765 +      END;
17766 +    END;
17767 +  END;
17768 +ELSE DO;
17769 +  IF  NOT MISSING(AffluenceGrade ) AND
17770 +                    12.5 <= AffluenceGrade  THEN DO;
17771 +    _ARBFMT_1 = PUT( REP_Gender , $CHAR1.);
17772 +     %DMNORMIP( _ARBFMT_1);
17773 +    IF _ARBFMT_1 IN ('M' ,'U' ) THEN DO;
17774 +      IF  NOT MISSING(AffluenceGrade ) AND
17775 +                        18.5 <= AffluenceGrade  THEN DO;
17776 +        _NODE_  =                   29;
17777 +        _LEAF_  =                   17;
17778 +        P_TargetBuy0  =     0.16666666666666;
17779 +        P_TargetBuy1  =     0.83333333333333;
17780 +        Q_TargetBuy0  =     0.16666666666666;
17781 +        Q_TargetBuy1  =     0.83333333333333;
17782 +        V_TargetBuy0  =     0.16666666666666;
17783 +        V_TargetBuy1  =     0.83333333333333;
17784 +        I_TargetBuy  = '1' ;
17785 +        U_TargetBuy  =                    1;
17786 +        END;
17787 +      ELSE DO;
17788 +        _NODE_  =                   28;
17789 +        _LEAF_  =                   16;
17790 +        P_TargetBuy0  =     0.81617647058823;
17791 +        P_TargetBuy1  =     0.18382352941176;
17792 +        Q_TargetBuy0  =     0.81617647058823;
17793 +        Q_TargetBuy1  =     0.18382352941176;
17794 +        V_TargetBuy0  =     0.79856115107913;
17795 +        V_TargetBuy1  =     0.20143884892086;
17796 +        I_TargetBuy  = '0' ;
17797 +        U_TargetBuy  =                    0;
17798 +        END;
17799 +      END;
17800 +    ELSE DO;
17801 +      _ARBFMT_12 = PUT( MobileApplications , BEST12.);
17802 +       %DMNORMIP( _ARBFMT_12);
17803 +      IF _ARBFMT_12 IN ('0' ) THEN DO;
17804 +        _NODE_  =                   31;
17805 +        _LEAF_  =                   20;
17806 +        P_TargetBuy0  =     0.58522727272727;
17807 +        P_TargetBuy1  =     0.41477272727272;
17808 +        Q_TargetBuy0  =     0.58522727272727;
17809 +        Q_TargetBuy1  =     0.41477272727272;
17810 +        V_TargetBuy0  =      0.6021505376344;
17811 +        V_TargetBuy1  =     0.39784946236559;
17812 +        I_TargetBuy  = '0' ;
17813 +        U_TargetBuy  =                    0;
17814 +        END;
17815 +      ELSE DO;
17816 +        IF  NOT MISSING(DayCareProducts ) AND
17817 +          DayCareProducts  <                  0.5 THEN DO;
17818 +          _NODE_  =                   58;
17819 +          _LEAF_  =                   18;
17820 +          P_TargetBuy0  =               0.6875;
17821 +          P_TargetBuy1  =               0.3125;
17822 +          Q_TargetBuy0  =               0.6875;
17823 +          Q_TargetBuy1  =               0.3125;
17824 +          V_TargetBuy0  =     0.59090909090909;
17825 +          V_TargetBuy1  =      0.4090909090909;
17826 +          I_TargetBuy  = '0' ;
17827 +          U_TargetBuy  =                    0;
17828 +          END;
17829 +        ELSE DO;
17830 +          _NODE_  =                   59;
17831 +          _LEAF_  =                   19;
17832 +          P_TargetBuy0  =     0.25925925925925;
17833 +          P_TargetBuy1  =     0.74074074074074;
17834 +          Q_TargetBuy0  =     0.25925925925925;
17835 +          Q_TargetBuy1  =     0.74074074074074;
17836 +          V_TargetBuy0  =     0.27536231884057;
17837 +          V_TargetBuy1  =     0.72463768115942;
17838 +          I_TargetBuy  = '1' ;
17839 +          U_TargetBuy  =                    1;
17840 +          END;
17841 +        END;
17842 +      END;
17843 +    END;
17844 +  ELSE DO;
17845 +    _NODE_  =                    6;
17846 +    _LEAF_  =                   15;
17847 +    P_TargetBuy0  =     0.88150029886431;
17848 +    P_TargetBuy1  =     0.11849970113568;
17849 +    Q_TargetBuy0  =     0.88150029886431;
17850 +    Q_TargetBuy1  =     0.11849970113568;
17851 +    V_TargetBuy0  =     0.87782805429864;
17852 +    V_TargetBuy1  =     0.12217194570135;
17853 +    I_TargetBuy  = '0' ;
17854 +    U_TargetBuy  =                    0;
17855 +    END;
17856 +  END;
17857 +
17858 +*****  RESIDUALS R_ *************;
17859 +IF  F_TargetBuy  NE '0'
17860 +AND F_TargetBuy  NE '1'  THEN DO;
17861 +        R_TargetBuy0  = .;
17862 +        R_TargetBuy1  = .;
17863 + END;
17864 + ELSE DO;
17865 +       R_TargetBuy0  =  -P_TargetBuy0 ;
17866 +       R_TargetBuy1  =  -P_TargetBuy1 ;
17867 +       SELECT( F_TargetBuy  );
17868 +          WHEN( '0'  ) R_TargetBuy0  = R_TargetBuy0  +1;
17869 +          WHEN( '1'  ) R_TargetBuy1  = R_TargetBuy1  +1;
17870 +       END;
17871 + END;
17872 +
17873 +****************************************************************;
17874 +******          END OF DECISION TREE SCORING CODE         ******;
17875 +****************************************************************;
17876 +
17877 +drop _LEAF_;
NOTE: %INCLUDE (level 1) ending.
17878  run;

NOTE: DATA STEP view saved on file EMWS1.TREE3_TRAIN.
NOTE: A stored DATA STEP view cannot run under a different operating system.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
      

17879  quit;
17880  filename emflow;
NOTE: Fileref EMFLOW has been deassigned.

17881  filename emflow "D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\EMFLOWSCORE.sas";
17882  *------------------------------------------------------------*;
17883  * Tree3: Scoring VALIDATE data;
17884  *------------------------------------------------------------*;
17885  data EMWS1.Tree3_VALIDATE
17886  / view=EMWS1.Tree3_VALIDATE
17887  ;
17888  set EMWS1.Part2_VALIDATE
17889  ;
17890  %inc emflow;
NOTE: %INCLUDE (level 1) file EMFLOW is file D:\Nida\Data mining\datamining\BOGO\Workspaces\EMWS1\Tree3\EMFLOWSCORE.sas.
17891 +****************************************************************;
17892 +******             DECISION TREE SCORING CODE             ******;
17893 +****************************************************************;
17894 +
17895 +******         LENGTHS OF NEW CHARACTER VARIABLES         ******;
17896 +LENGTH F_TargetBuy  $   12;
17897 +LENGTH I_TargetBuy  $   12;
17898 +LENGTH _WARN_  $    4;
17899 +
17900 +******              LABELS FOR NEW VARIABLES              ******;
17901 +label _NODE_ = 'Node' ;
17902 +label _LEAF_ = 'Leaf' ;
17903 +label P_TargetBuy0 = 'Predicted: TargetBuy=0' ;
17904 +label P_TargetBuy1 = 'Predicted: TargetBuy=1' ;
17905 +label Q_TargetBuy0 = 'Unadjusted P: TargetBuy=0' ;
17906 +label Q_TargetBuy1 = 'Unadjusted P: TargetBuy=1' ;
17907 +label V_TargetBuy0 = 'Validated: TargetBuy=0' ;
17908 +label V_TargetBuy1 = 'Validated: TargetBuy=1' ;
17909 +label R_TargetBuy0 = 'Residual: TargetBuy=0' ;
17910 +label R_TargetBuy1 = 'Residual: TargetBuy=1' ;
17911 +label F_TargetBuy = 'From: TargetBuy' ;
17912 +label I_TargetBuy = 'Into: TargetBuy' ;
17913 +label U_TargetBuy = 'Unnormalized Into: TargetBuy' ;
17914 +label _WARN_ = 'Warnings' ;
17915 +
17916 +
17917 +******      TEMPORARY VARIABLES FOR FORMATTED VALUES      ******;
17918 +LENGTH _ARBFMT_12 $     12; DROP _ARBFMT_12;
17919 +_ARBFMT_12 = ' '; /* Initialize to avoid warning. */
17920 +LENGTH _ARBFMT_1 $      1; DROP _ARBFMT_1;
17921 +_ARBFMT_1 = ' '; /* Initialize to avoid warning. */
17922 +
17923 +
17924 +_ARBFMT_12 = PUT( TargetBuy , BEST12.);
17925 + %DMNORMCP( _ARBFMT_12, F_TargetBuy );
17926 +
17927 +******             ASSIGN OBSERVATION TO NODE             ******;
17928 +IF  NOT MISSING(REP_Age ) AND
17929 +  REP_Age  <                 44.5 THEN DO;
17930 +  _ARBFMT_1 = PUT( REP_Gender , $CHAR1.);
17931 +   %DMNORMIP( _ARBFMT_1);
17932 +  IF _ARBFMT_1 IN ('M' ,'U' ) THEN DO;
17933 +    IF  NOT MISSING(AffluenceGrade ) AND
17934 +                      10.5 <= AffluenceGrade  THEN DO;
17935 +      IF  NOT MISSING(AffluenceGrade ) AND
17936 +                        15.5 <= AffluenceGrade  THEN DO;
17937 +        _NODE_  =                   19;
17938 +        _LEAF_  =                    6;
17939 +        P_TargetBuy0  =     0.12195121951219;
17940 +        P_TargetBuy1  =      0.8780487804878;
17941 +        Q_TargetBuy0  =     0.12195121951219;
17942 +        Q_TargetBuy1  =      0.8780487804878;
17943 +        V_TargetBuy0  =     0.20930232558139;
17944 +        V_TargetBuy1  =      0.7906976744186;
17945 +        I_TargetBuy  = '1' ;
17946 +        U_TargetBuy  =                    1;
17947 +        END;
17948 +      ELSE DO;
17949 +        IF  NOT MISSING(NightRepairProducts ) AND
17950 +          NightRepairProducts  <                  0.5 THEN DO;
17951 +          _NODE_  =                   36;
17952 +          _LEAF_  =                    4;
17953 +          P_TargetBuy0  =     0.64516129032258;
17954 +          P_TargetBuy1  =     0.35483870967741;
17955 +          Q_TargetBuy0  =     0.64516129032258;
17956 +          Q_TargetBuy1  =     0.35483870967741;
17957 +          V_TargetBuy0  =             0.546875;
17958 +          V_TargetBuy1  =             0.453125;
17959 +          I_TargetBuy  = '0' ;
17960 +          U_TargetBuy  =                    0;
17961 +          END;
17962 +        ELSE DO;
17963 +          _NODE_  =                   37;
17964 +          _LEAF_  =                    5;
17965 +          P_TargetBuy0  =     0.41666666666666;
17966 +          P_TargetBuy1  =     0.58333333333333;
17967 +          Q_TargetBuy0  =     0.41666666666666;
17968 +          Q_TargetBuy1  =     0.58333333333333;
17969 +          V_TargetBuy0  =     0.51351351351351;
17970 +          V_TargetBuy1  =     0.48648648648648;
17971 +          I_TargetBuy  = '1' ;
17972 +          U_TargetBuy  =                    1;
17973 +          END;
17974 +        END;
17975 +      END;
17976 +    ELSE DO;
17977 +      IF  NOT MISSING(REP_Age ) AND
17978 +        REP_Age  <                 29.5 THEN DO;
17979 +        _ARBFMT_12 = PUT( MobileApplications , BEST12.);
17980 +         %DMNORMIP( _ARBFMT_12);
17981 +        IF _ARBFMT_12 IN ('1' ) THEN DO;
17982 +          _NODE_  =                   33;
17983 +          _LEAF_  =                    2;
17984 +          P_TargetBuy0  =     0.09090909090909;
17985 +          P_TargetBuy1  =      0.9090909090909;
17986 +          Q_TargetBuy0  =     0.09090909090909;
17987 +          Q_TargetBuy1  =      0.9090909090909;
17988 +          V_TargetBuy0  =     0.03703703703703;
17989 +          V_TargetBuy1  =     0.96296296296296;
17990 +          I_TargetBuy  = '1' ;
17991 +          U_TargetBuy  =                    1;
17992 +          END;
17993 +        ELSE DO;
17994 +          _NODE_  =                   32;
17995 +          _LEAF_  =                    1;
17996 +          P_TargetBuy0  =     0.73170731707317;
17997 +          P_TargetBuy1  =     0.26829268292682;
17998 +          Q_TargetBuy0  =     0.73170731707317;
17999 +          Q_TargetBuy1  =     0.26829268292682;
18000 +          V_TargetBuy0  =     0.65116279069767;
18001 +          V_TargetBuy1  =     0.34883720930232;
18002 +          I_TargetBuy  = '0' ;
18003 +          U_TargetBuy  =                    0;
18004 +          END;
18005 +        END;
18006 +      ELSE DO;
18007 +        _NODE_  =                   17;
18008 +        _LEAF_  =                    3;
18009 +        P_TargetBuy0  =     0.80877742946708;
18010 +        P_TargetBuy1  =     0.19122257053291;
18011 +        Q_TargetBuy0  =     0.80877742946708;
18012 +        Q_TargetBuy1  =     0.19122257053291;
18013 +        V_TargetBuy0  =     0.79756468797564;
18014 +        V_TargetBuy1  =     0.20243531202435;
18015 +        I_TargetBuy  = '0' ;
18016 +        U_TargetBuy  =                    0;
18017 +        END;
18018 +      END;
18019 +    END;
18020 +  ELSE DO;
18021 +    IF  NOT MISSING(AffluenceGrade ) AND
18022 +      AffluenceGrade  <                  8.5 THEN DO;
18023 +      IF  NOT MISSING(REP_Age ) AND
18024 +        REP_Age  <                 31.5 THEN DO;
18025 +        _NODE_  =                   20;
18026 +        _LEAF_  =                    7;
18027 +        P_TargetBuy0  =     0.17582417582417;
18028 +        P_TargetBuy1  =     0.82417582417582;
18029 +        Q_TargetBuy0  =     0.17582417582417;
18030 +        Q_TargetBuy1  =     0.82417582417582;
18031 +        V_TargetBuy0  =     0.31683168316831;
18032 +        V_TargetBuy1  =     0.68316831683168;
18033 +        I_TargetBuy  = '1' ;
18034 +        U_TargetBuy  =                    1;
18035 +        END;
18036 +      ELSE DO;
18037 +        IF  NOT MISSING(NightRepairProducts ) AND
18038 +          NightRepairProducts  <                  0.5 THEN DO;
18039 +          _NODE_  =                   42;
18040 +          _LEAF_  =                    8;
18041 +          P_TargetBuy0  =     0.73142857142857;
18042 +          P_TargetBuy1  =     0.26857142857142;
18043 +          Q_TargetBuy0  =     0.73142857142857;
18044 +          Q_TargetBuy1  =     0.26857142857142;
18045 +          V_TargetBuy0  =     0.65340909090909;
18046 +          V_TargetBuy1  =      0.3465909090909;
18047 +          I_TargetBuy  = '0' ;
18048 +          U_TargetBuy  =                    0;
18049 +          END;
18050 +        ELSE DO;
18051 +          _ARBFMT_12 = PUT( FacebookLike , BEST12.);
18052 +           %DMNORMIP( _ARBFMT_12);
18053 +          IF _ARBFMT_12 IN ('1' ) THEN DO;
18054 +            _NODE_  =                   65;
18055 +            _LEAF_  =                   10;
18056 +            P_TargetBuy0  =     0.37426900584795;
18057 +            P_TargetBuy1  =     0.62573099415204;
18058 +            Q_TargetBuy0  =     0.37426900584795;
18059 +            Q_TargetBuy1  =     0.62573099415204;
18060 +            V_TargetBuy0  =     0.38541666666666;
18061 +            V_TargetBuy1  =     0.61458333333333;
18062 +            I_TargetBuy  = '1' ;
18063 +            U_TargetBuy  =                    1;
18064 +            END;
18065 +          ELSE DO;
18066 +            _NODE_  =                   64;
18067 +            _LEAF_  =                    9;
18068 +            P_TargetBuy0  =     0.56950672645739;
18069 +            P_TargetBuy1  =      0.4304932735426;
18070 +            Q_TargetBuy0  =     0.56950672645739;
18071 +            Q_TargetBuy1  =      0.4304932735426;
18072 +            V_TargetBuy0  =     0.63084112149532;
18073 +            V_TargetBuy1  =     0.36915887850467;
18074 +            I_TargetBuy  = '0' ;
18075 +            U_TargetBuy  =                    0;
18076 +            END;
18077 +          END;
18078 +        END;
18079 +      END;
18080 +    ELSE DO;
18081 +      _ARBFMT_12 = PUT( MobileApplications , BEST12.);
18082 +       %DMNORMIP( _ARBFMT_12);
18083 +      IF _ARBFMT_12 IN ('0' ) THEN DO;
18084 +        IF  NOT MISSING(AffluenceGrade ) AND
18085 +                          11.5 <= AffluenceGrade  THEN DO;
18086 +          _NODE_  =                   45;
18087 +          _LEAF_  =                   13;
18088 +          P_TargetBuy0  =     0.23170731707317;
18089 +          P_TargetBuy1  =     0.76829268292682;
18090 +          Q_TargetBuy0  =     0.23170731707317;
18091 +          Q_TargetBuy1  =     0.76829268292682;
18092 +          V_TargetBuy0  =     0.19642857142857;
18093 +          V_TargetBuy1  =     0.80357142857142;
18094 +          I_TargetBuy  = '1' ;
18095 +          U_TargetBuy  =                    1;
18096 +          END;
18097 +        ELSE DO;
18098 +          IF  NOT MISSING(LotionProducts ) AND
18099 +                             4.5 <= LotionProducts  THEN DO;
18100 +            _NODE_  =                   67;
18101 +            _LEAF_  =                   12;
18102 +            P_TargetBuy0  =     0.61904761904761;
18103 +            P_TargetBuy1  =     0.38095238095238;
18104 +            Q_TargetBuy0  =     0.61904761904761;
18105 +            Q_TargetBuy1  =     0.38095238095238;
18106 +            V_TargetBuy0  =     0.53658536585365;
18107 +            V_TargetBuy1  =     0.46341463414634;
18108 +            I_TargetBuy  = '0' ;
18109 +            U_TargetBuy  =                    0;
18110 +            END;
18111 +          ELSE DO;
18112 +            _NODE_  =                   66;
18113 +            _LEAF_  =                   11;
18114 +            P_TargetBuy0  =     0.34269662921348;
18115 +            P_TargetBuy1  =     0.65730337078651;
18116 +            Q_TargetBuy0  =     0.34269662921348;
18117 +            Q_TargetBuy1  =     0.65730337078651;
18118 +            V_TargetBuy0  =     0.41545893719806;
18119 +            V_TargetBuy1  =     0.58454106280193;
18120 +            I_TargetBuy  = '1' ;
18121 +            U_TargetBuy  =                    1;
18122 +            END;
18123 +          END;
18124 +        END;
18125 +      ELSE DO;
18126 +        _NODE_  =                   23;
18127 +        _LEAF_  =                   14;
18128 +        P_TargetBuy0  =                 0.15;
18129 +        P_TargetBuy1  =                 0.85;
18130 +        Q_TargetBuy0  =                 0.15;
18131 +        Q_TargetBuy1  =                 0.85;
18132 +        V_TargetBuy0  =     0.18568994889267;
18133 +        V_TargetBuy1  =     0.81431005110732;
18134 +        I_TargetBuy  = '1' ;
18135 +        U_TargetBuy  =                    1;
18136 +        END;
18137 +      END;
18138 +    END;
18139 +  END;
18140 +ELSE DO;
18141 +  IF  NOT MISSING(AffluenceGrade ) AND
18142 +                    12.5 <= AffluenceGrade  THEN DO;
18143 +    _ARBFMT_1 = PUT( REP_Gender , $CHAR1.);
18144 +     %DMNORMIP( _ARBFMT_1);
18145 +    IF _ARBFMT_1 IN ('M' ,'U' ) THEN DO;
18146 +      IF  NOT MISSING(AffluenceGrade ) AND
18147 +                        18.5 <= AffluenceGrade  THEN DO;
18148 +        _NODE_  =                   29;
18149 +        _LEAF_  =                   17;
18150 +        P_TargetBuy0  =     0.16666666666666;
18151 +        P_TargetBuy1  =     0.83333333333333;
18152 +        Q_TargetBuy0  =     0.16666666666666;
18153 +        Q_TargetBuy1  =     0.83333333333333;
18154 +        V_TargetBuy0  =     0.16666666666666;
18155 +        V_TargetBuy1  =     0.83333333333333;
18156 +        I_TargetBuy  = '1' ;
18157 +        U_TargetBuy  =                    1;
18158 +        END;
18159 +      ELSE DO;
18160 +        _NODE_  =                   28;
18161 +        _LEAF_  =                   16;
18162 +        P_TargetBuy0  =     0.81617647058823;
18163 +        P_TargetBuy1  =     0.18382352941176;
18164 +        Q_TargetBuy0  =     0.81617647058823;
18165 +        Q_TargetBuy1  =     0.18382352941176;
18166 +        V_TargetBuy0  =     0.79856115107913;
18167 +        V_TargetBuy1  =     0.20143884892086;
18168 +        I_TargetBuy  = '0' ;
18169 +        U_TargetBuy  =                    0;
18170 +        END;
18171 +      END;
18172 +    ELSE DO;
18173 +      _ARBFMT_12 = PUT( MobileApplications , BEST12.);
18174 +       %DMNORMIP( _ARBFMT_12);
18175 +      IF _ARBFMT_12 IN ('0' ) THEN DO;
18176 +        _NODE_  =                   31;
18177 +        _LEAF_  =                   20;
18178 +        P_TargetBuy0  =     0.58522727272727;
18179 +        P_TargetBuy1  =     0.41477272727272;
18180 +        Q_TargetBuy0  =     0.58522727272727;
18181 +        Q_TargetBuy1  =     0.41477272727272;
18182 +        V_TargetBuy0  =      0.6021505376344;
18183 +        V_TargetBuy1  =     0.39784946236559;
18184 +        I_TargetBuy  = '0' ;
18185 +        U_TargetBuy  =                    0;
18186 +        END;
18187 +      ELSE DO;
18188 +        IF  NOT MISSING(DayCareProducts ) AND
18189 +          DayCareProducts  <                  0.5 THEN DO;
18190 +          _NODE_  =                   58;
18191 +          _LEAF_  =                   18;
18192 +          P_TargetBuy0  =               0.6875;
18193 +          P_TargetBuy1  =               0.3125;
18194 +          Q_TargetBuy0  =               0.6875;
18195 +          Q_TargetBuy1  =               0.3125;
18196 +          V_TargetBuy0  =     0.59090909090909;
18197 +          V_TargetBuy1  =      0.4090909090909;
18198 +          I_TargetBuy  = '0' ;
18199 +          U_TargetBuy  =                    0;
18200 +          END;
18201 +        ELSE DO;
18202 +          _NODE_  =                   59;
18203 +          _LEAF_  =                   19;
18204 +          P_TargetBuy0  =     0.25925925925925;
18205 +          P_TargetBuy1  =     0.74074074074074;
18206 +          Q_TargetBuy0  =     0.25925925925925;
18207 +          Q_TargetBuy1  =     0.74074074074074;
18208 +          V_TargetBuy0  =     0.27536231884057;
18209 +          V_TargetBuy1  =     0.72463768115942;
18210 +          I_TargetBuy  = '1' ;
18211 +          U_TargetBuy  =                    1;
18212 +          END;
18213 +        END;
18214 +      END;
18215 +    END;
18216 +  ELSE DO;
18217 +    _NODE_  =                    6;
18218 +    _LEAF_  =                   15;
18219 +    P_TargetBuy0  =     0.88150029886431;
18220 +    P_TargetBuy1  =     0.11849970113568;
18221 +    Q_TargetBuy0  =     0.88150029886431;
18222 +    Q_TargetBuy1  =     0.11849970113568;
18223 +    V_TargetBuy0  =     0.87782805429864;
18224 +    V_TargetBuy1  =     0.12217194570135;
18225 +    I_TargetBuy  = '0' ;
18226 +    U_TargetBuy  =                    0;
18227 +    END;
18228 +  END;
18229 +
18230 +*****  RESIDUALS R_ *************;
18231 +IF  F_TargetBuy  NE '0'
18232 +AND F_TargetBuy  NE '1'  THEN DO;
18233 +        R_TargetBuy0  = .;
18234 +        R_TargetBuy1  = .;
18235 + END;
18236 + ELSE DO;
18237 +       R_TargetBuy0  =  -P_TargetBuy0 ;
18238 +       R_TargetBuy1  =  -P_TargetBuy1 ;
18239 +       SELECT( F_TargetBuy  );
18240 +          WHEN( '0'  ) R_TargetBuy0  = R_TargetBuy0  +1;
18241 +          WHEN( '1'  ) R_TargetBuy1  = R_TargetBuy1  +1;
18242 +       END;
18243 + END;
18244 +
18245 +****************************************************************;
18246 +******          END OF DECISION TREE SCORING CODE         ******;
18247 +****************************************************************;
18248 +
18249 +drop _LEAF_;
NOTE: %INCLUDE (level 1) ending.
18250  run;

NOTE: DATA STEP view saved on file EMWS1.TREE3_VALIDATE.
NOTE: A stored DATA STEP view cannot run under a different operating system.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds
      

18251  quit;
18252  filename emflow;
NOTE: Fileref EMFLOW has been deassigned.

NOTE: View EMWS1.TREE3_TRAIN.VIEW used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
      
18254  proc sort data=WORK.EM_USER_REPORT;
18255  by ID VIEW;
18256  run;

NOTE: There were 132 observations read from the data set WORK.EM_USER_REPORT.
NOTE: The data set WORK.EM_USER_REPORT has 132 observations and 4 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

18257  *------------------------------------------------------------*;
18258  * Tree3: Computing metadata for TRAIN data;
18259  *------------------------------------------------------------*;

NOTE: View EMWS1.TREE3_TRAIN.VIEW used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
      
18656  data EMWS1.Tree3_EMINFO;
18657  length TARGET KEY $32 DATA $43;
18658  input TARGET KEY DATA $;
18659  cards;

NOTE: The data set EMWS1.TREE3_EMINFO has 3 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

18663  run;
18664  proc sort data = EMWS1.Tree3_EMINFO NOTHREADS;
18665  by TARGET KEY;
18666  run;

NOTE: There were 3 observations read from the data set EMWS1.TREE3_EMINFO.
NOTE: The data set EMWS1.TREE3_EMINFO has 3 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

18667  proc sort data = EMWS1.Ids2_EMINFO OUT=WORK.SORTEDEMINFO NOTHREADS;
18668  by TARGET KEY;
18669  run;

NOTE: There were 3 observations read from the data set EMWS1.IDS2_EMINFO.
NOTE: The data set WORK.SORTEDEMINFO has 3 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

18670  proc sort data = EMWS1.Tree3_EMINFO OUT=WORK.TEMP_INFO NOTHREADS;
18671  by TARGET KEY;
18672  run;

NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 3 observations read from the data set EMWS1.TREE3_EMINFO.
NOTE: The data set WORK.TEMP_INFO has 3 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

18673  data EMWS1.Tree3_EMINFO;
18674  merge WORK.SORTEDEMINFO WORK.TEMP_INFO;
18675  by TARGET KEY;
18676  run;

NOTE: There were 3 observations read from the data set WORK.SORTEDEMINFO.
NOTE: There were 3 observations read from the data set WORK.TEMP_INFO.
NOTE: The data set EMWS1.TREE3_EMINFO has 4 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

18677  proc datasets lib=work nolist;
18678  delete TEMP_INFO SORTEDEMINFO;
18679  run;

NOTE: Deleting WORK.TEMP_INFO (memtype=DATA).
NOTE: Deleting WORK.SORTEDEMINFO (memtype=DATA).
18680  quit;

NOTE: PROCEDURE DATASETS used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

NOTE: View EMWS1.TREE3_TRAIN.VIEW used (Total process time):
      real time           0.07 seconds
      cpu time            0.07 seconds
      
NOTE: View EMWS1.TREE3_VALIDATE.VIEW used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
      
